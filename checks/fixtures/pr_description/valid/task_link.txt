Refactoring code structure for TASK-789.

This refactoring improves maintainability and performance. 